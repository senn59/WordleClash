@page
@using Org.BouncyCastle.Crypto.Engines
@using WordleClash.Core.Enums
@model WordleClash.Web.Pages.SingleplayerModel

@{
    ViewData["Title"] = "Singleplayer";
}

<div class="wrapper">
    @{
        if (Model.Status is GameStatus.Won or GameStatus.Lost)
        {
            <div class="game-end-overlay">
                <div class="game-end-overlay-wrapper">
                    <form method="post" id="restartForm">
                        @if (Model.Status == GameStatus.Won)
                        {
                            <div class="icon">&#127942;</div>
                            <h1>YOU WIN!</h1>
                        }
                        else
                        {
                            <h1>YOU LOSE!</h1>
                        }
                        <div class="buttons">
                            <button class="custom-btn custom-btn-primary" type="submit">New Game</button>
                            <button class="custom-btn custom-btn-secondary" onclick="CloseOverlay()">Close</button>
                        </div>
                        <input type="hidden" name="NewGame" value="true"/>
                    </form>
                </div>
            </div>
        }
    }

    <div class="wordle">
        @for (var i = 0; i < Model.MaxTries; i++)
        {
            <div class="d-flex wordle-row">
                @if (i < Model.MoveHistory.Count && Model.MoveHistory.Count > 0)
                {
                    @foreach (var lr in Model.MoveHistory[i].WordAnalysis)
                    {
                        <div class="wordle-tile @lr.Feedback">@lr.Letter</div>
                    }
                }
                else
                {
                    @for (var j = 0; j < 5; j++)
                    {
                        <div class="wordle-tile"></div>
                    }
                }
            </div>
        }
    </div>
</div>
<form method="post" id="guessForm">
    <input type="hidden" name="Guess" id="guessInput">
</form>

@section Scripts {
    <script src="~/js/WriteInTiles.js"></script>
    <script>
        const CloseOverlay = () => {
            document.querySelector(".game-end-overlay").remove();
        }
    </script>
}
